---
- name: Delete compute instance(s)
  hosts: localhost
  connection: local
  gather_facts: no
  
  vars:
    service_account_email: teadd-provision@teadd-blog.iam.gserviceaccount.com
    credentials_file: teadd_provision.privatekey.json
    project_id: teadd-blog
    machine_type: f1-micro
    image: centos-7
    zone: europe-west1-b
  
  tasks:
  - name: Delete instances
    gce:
      instance_names: ghost-app
      state: deleted
      zone: "{{ zone }}"
      service_account_email: "{{ service_account_email }}"
      credentials_file: "{{ credentials_file }}"
      project_id: "{{ project_id }}"
    register: app_servers

  - name: Delete DNS 'A' record for blog2.teadd.uk
    gcdns_record:
      state: absent
      zone: teadd.uk.
      type: A
      record: blog2.teadd.uk
      credentials_file: "{{ credentials_file }}"
      service_account_email: "{{ service_account_email }}"
      project_id: "{{ project_id }}"
      overwrite: true

  - name: Delete firewall rules
    gce_net:
      state: absent
      name: default
      fwname: mb-ghost-app-http
      service_account_email: "{{ service_account_email }}"
      credentials_file: "{{ credentials_file }}"
      project_id: "{{ project_id }}"
